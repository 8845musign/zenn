---
title: "Next.jsã§nuqsã‚’è©¦ã™ï¼ˆ+ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['nextjs', 'react']
published: true
---

URLã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¼ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¿ã‚¤ãƒ—ã‚»ãƒ¼ãƒ•ã«æ‰±ãˆã‚‹nuqsã‚’è©¦ã—ã¦ã¿ãŸã€‚

https://nuqs.47ng.com/

æœ€æ–°ã®Next.jsï¼ˆv15ï¼‰ã§ã¯nuqsã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡ºæ¥ãªã‹ã£ãŸã€‚React.jsã®ä¾å­˜ãŒè§£æ±ºã§ããªã„ã€‚nuqsè‡ªä½“ã¯2.0.4ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã€‚

https://nuqs.47ng.com/docs/adapters#nextjs-app-router

`app-router` ã¨ `page-router` ã§å°å…¥æ–¹æ³•ãŒé•ã†ã‚‰ã—ã„ã€‚ä»Šå›ã¯app-routerå‰æã§é€²ã‚ã‚‹ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’`NuxtAdapter`ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã€‚ ç‰¹ã«`use client`ã‚’æ„è­˜ã™ã‚‹å¿…è¦ã¯ãªã„ã‚‰ã—ã„

```jsx
import type { Metadata } from "next";
import localFont from "next/font/local";
import "./globals.css";

import { NuqsAdapter } from "nuqs/adapters/next/app";

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body>
        <NuqsAdapter>{children}</NuqsAdapter>
      </body>
    </html>
  );
}
```

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰åˆ©ç”¨ã™ã‚‹å ´åˆã¯æ¬¡ã®ç”¨ã«ä½¿ã†ã€‚

```jsx
"use client";

import { useQueryState } from "nuqs";

export default function Home() {
  const [name, setName] = useQueryState("name");

  return (
    <>
      <div>
        {" "}
        <input value={name || ""} onChange={(e) => setName(e.target.value)} />
        <button type="button" onClick={() => setName(null)}>
          ã‚¯ãƒªã‚¢
        </button>
      </div>{" "}
      <p>{name || "åç„¡ã—ã•ã‚“"}ã“ã‚“ã«ã¡ã¯</p>
    </>
  );
}
```

ãŠã‚‚ã—ã‚ã“ã¨ã«setterçµŒç”±ã§å€¤ã‚’ã‹ãˆã‚‹ã¨ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå‹•çš„ã«å¤‰åŒ–ã™ã‚‹ã€‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å ´åˆã«ä½¿ãˆã‚‹ã®ã§ã¯ãªã„ã ã‚ã†ã‹ã€‚ãƒ•ã‚£ãƒ«ã‚¿ã®æ¡ä»¶ãŒã¯URLã§è¡¨ç¾ã•ã‚Œã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã§ã®å…±æœ‰ãŒã§ããŸã‚Šã‚ˆãä½¿ã†æ¡ä»¶ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ãŸã‚Šã¨æ´»ç”¨ç¯„å›²ãŒåœ°å‘³ã«åºƒã„ã ã‚ã†ã€‚

## ãƒ‘ãƒ¼ã‚µãƒ¼ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤

ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’ä½¿ãˆã°URLã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’æ•°å€¤ç­‰ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚ã§ãã‚‹ã€‚

```jsx
const [count, setCount] = useQueryState(  
    "count",  
    parseAsInteger.withDefault(0),  
);
```

withDefaultã¯åå‰ã®é€šã‚Šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒæŒ‡å®šã•ã‚Œãªã‹ã£ãŸå ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’æŒ‡å®šã§ãã‚‹ã€‚ã“ã®å€¤ãŒURLã«è¨­å®šã•ã‚Œã‚‹ã“ã¨ã¯ãªã„ã€‚ã¡ãªã¿ã«ã€æ•°å€¤ã¨ã—ã¦è§£é‡ˆã§ããªã„å€¤ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«æŒ‡å®šã—ãŸå ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãŒä½¿ã‚ã‚Œã‚‹ã‚ˆã†ã ã€‚

ãƒ‘ãƒ¼ã‚µãƒ¼ã¯è‡ªå‰ã§å®Ÿè£…ã™ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚

## ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚‚å¯¾å¿œã—ã¦ã„ã‚‹ã€‚ãƒã‚¹ãƒˆã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹å ´åˆã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’é–¢æ•°ã¨ã—ã¦åˆ‡ã‚Šå‡ºã™ã“ã¨ã‚’æ¨å¥¨ã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚

```jsx
import { createSearchParamsCache, parseAsString } from "nuqs/server";

export const searchParam = {
  name: parseAsString.withDefault("è…¹ç­‹"),
};

export const serachParamsCache = createSearchParamsCache(searchParam);
```

```jsx
import type { SearchParams } from "nuqs/server";
import { serachParamsCache } from "./searchParams";

type PageProps = {
  searchParams: SearchParams;
};

export default function Home({ searchParams }: PageProps) {
  const { name } = serachParamsCache.parse(searchParams);
  return (
    <>
      <p>{name || "åç„¡ã—ã•ã‚“"}ã“ã‚“ã«ã¡ã¯</p>
    </>
  );
}
```

`createSearchParamsCache`ã®cacheã¯reactã®`cache`ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚‰ã—ã„ã€‚ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å®šç¾©ï¼ˆã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯`searchParam`ï¼‰ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰æ‰±ã†ã“ã¨ã‚‚ã§ãã‚‹ã€‚

```jsx
"use client";

import { useQueryStates } from "nuqs";
import { searchParam } from "./searchParams";

export function Child() {
  const [{ name }, setParams] = useQueryStates(searchParam);
  return (
    <>
      <p>{name}</p>
      <button
        type="button"
        onClick={() => {
          setParams({ name: "John" });
        }}
      >
        å¤‰æ›´
      </button>
    </>
  );
}
```

ãŸã ã—ã€setterã‚’ä½¿ã£ã¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ã‚‚ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯æ›´æ–°ã•ã‚Œãªã„ã€‚
